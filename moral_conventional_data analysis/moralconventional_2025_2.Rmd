---
title: "haleh_project_mejia"
author: "Miguel Mejia"
date: "`r Sys.Date()`"
output: 
  html_document:
    toc: true
    toc_depth: 6
    toc_float: true
    theme: united
    highlight: monochrome
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE, comment = NA, message = NA)

library(tidyverse)
# install.packages("barsurf") doesn't work
# install.packages("bivariate") doesn't work
library(broom)
library(broom.mixed)
library(car)
library("designr")
library("dobson")
library("extraDistr")
library(ggpubr)
library(Hmisc)
# install.packages("hypr") package ‘hypr’ is in use and will not be installed
# install.packages("intoo") doesn't work
library("kableExtra")
library(lme4)
library(lmerTest)
library(magrittr)
library("MASS")
library(scales)
# install.packages("SIN") doesn't work'
library("tidyverse")
library(viridis)
library("ordinal")
```

# Study 1
```{r}

# MM: Set working directory
setwd("C:/Users/Bubulubu/Documents/haleh_project_2024")

#First run the 0-clean analysis script
source("analyses/0-clean.R")

# Load cleaned data - 2 dfs
rm(list = ls())

study_1_data <- read.csv("data/cleaned_data/study1_mc_all_data.csv") %>%
  mutate(subid = factor(subid), 
         task = factor(task), 
         item = factor(item), 
         answer = as.numeric(answer), 
         site = factor(site), 
         age.c = as.vector(scale(age, center = TRUE, scale = TRUE)), 
         age.group = as.numeric(as.character(age.group)))%>%
  mutate(age.bin = ifelse(age.group < 7, "5-6", 
                          ifelse((age.group >= 7 & age.group < 9), "7-8", "9-10")), 
         sex = ifelse(sex == "Female", "F",
                      ifelse(sex == "Male", "M", 
                             ifelse(sex == "", NA, as.character(sex)))))

study_1_subject_index <- study_1_data %>% 
  dplyr::arrange(site) %>% 
  dplyr::select(subid) %>% 
  distinct() %>% 
  mutate(subject_index = row_number())

study_1_data <- study_1_data %>% 
  merge(study_1_subject_index, by = "subid") %>%
  dplyr::select(subject_index, site, sex, age, age.c, transgression_type = task, item, q_kind_label, response = answer) %>%
  arrange(subject_index) %>%
  mutate(transgression_type = factor(transgression_type, levels = c("moral", "conv")))

study_1_response_acceptability_canada <- study_1_data %>% filter(site == "Canada" & q_kind_label == "Severity rating")
study_1_response_acceptability_india <- study_1_data %>% filter(site == "India" & q_kind_label == "Severity rating")
study_1_response_acceptability_iran <- study_1_data %>% filter(site == "Iran" & q_kind_label == "Severity rating")
study_1_response_acceptability_korea <- study_1_data %>% filter(site == "Korea" & q_kind_label == "Severity rating")

study_1_response_permissibility_canada <- study_1_data %>% filter(site == "Canada" & q_kind_label != "Severity rating") %>% rename(hypothetical = q_kind_label)
study_1_response_permissibility_india <- study_1_data %>% filter(site == "India" & q_kind_label != "Severity rating") %>% rename(hypothetical = q_kind_label)
study_1_response_permissibility_iran <- study_1_data %>% filter(site == "Iran" & q_kind_label != "Severity rating") %>% rename(hypothetical = q_kind_label)
study_1_response_permissibility_korea <- study_1_data %>% filter(site == "Korea" & q_kind_label != "Severity rating") %>% rename(hypothetical = q_kind_label)


set.seed(1234) #set random seed for reproducibility

```
## Acceptability ratings of moral and conventional items

### Canada Analysis

Model A: Response ~ Transgression Type * Age + (1 | Subject) +  (1 | Item)   
Model B: Response ~ Transgression Type + Age + (1 | Subject) +  (1 | Item)  

1.  Interaction term resulted in significant improvement to model fit ($\chi^{2}$(1) = 4.4116 *p* = 0.0357)  
2. Significant main interaction effect between transgression type and age ($\beta$ = 0.680, *z* = -2.089, *p* = 0.037, *CI* = (0.474, 0.976))  

#### Mixed Ordinal Regression

##### Model A
```{r}

### Ordinal Mixed Effects Model

# canada model with interaction
study_1_mod_canada_clmm_a <- clmm(as.factor(response) ~ transgression_type * age.c + (1| subject_index) + (1 | item), data = study_1_response_acceptability_canada)
summary(study_1_mod_canada_clmm_a)
```

##### Model B
```{r}
# canada model without interaction
study_1_mod_canada_clmm_b <- clmm(as.factor(response) ~ transgression_type + age.c + (1| subject_index) + (1 | item), data= study_1_response_acceptability_canada)
summary(study_1_mod_canada_clmm_b)
```

##### Model Comparison
```{r}
anova(study_1_mod_canada_clmm_a, study_1_mod_canada_clmm_b, test = 'lrt')
```


##### Model A Coefficiants (Log-odds)
```{r}
broom.mixed::tidy(study_1_mod_canada_clmm_a, conf.int = TRUE, exponentiate = FALSE) %>% mutate(p.value = round(p.value, 3)) %>% filter(coef.type != "intercept") %>% dplyr::select(-coef.type) %>% mutate_if(is.numeric, ~round(.x, digits = 3)) %>% kable()
```

##### Modal A Coefficients (Odds Ratio)
```{r}
broom.mixed::tidy(study_1_mod_canada_clmm_a, conf.int = TRUE, exponentiate = TRUE) %>% mutate(p.value = round(p.value, 3)) %>% filter(coef.type != "intercept") %>% dplyr::select(-coef.type) %>% mutate_if(is.numeric, ~round(.x, digits = 3)) %>% kable()

```


### India Analysis

Model A: Response ~ Transgression Type * Age + (1 | Subject) +  (1 | Item)   
Model B: Response ~ Transgression Type + Age + (1 | Subject) +  (1 | Item)   

1.  Interaction term resulted in significant improvement to model fit ($\chi^{2}$(1) = 4.2815, *p* = 0.03853)
2. Significant main interaction effect between transgression type and age ($\beta$ = 2.112, *z* = 2.089, *p* = 0.037, *CI* = (1.047, 4.258)) 

#### Mixed Ordinal Regression

##### Model A
```{r}

### Ordinal Mixed Effects Model

# india model with interaction
study_1_mod_india_clmm_a <- clmm(as.factor(response) ~ transgression_type * age.c + (1| subject_index) + (1 | item), data = study_1_response_acceptability_india)
summary(study_1_mod_india_clmm_a)
```

##### Model B
```{r}
# india model without interaction
study_1_mod_india_clmm_b <- clmm(as.factor(response) ~ transgression_type + age.c + (1| subject_index) + (1 | item), data= study_1_response_acceptability_india)
summary(study_1_mod_india_clmm_b)
```

##### Model Comparison
```{r}
anova(study_1_mod_india_clmm_a, study_1_mod_india_clmm_b, test = 'lrt')
```

##### Model A Coefficients (Log-odds)
```{r}
broom.mixed::tidy(study_1_mod_india_clmm_a, conf.int = TRUE, exponentiate = FALSE) %>% mutate(p.value = round(p.value, 3)) %>% filter(coef.type != "intercept") %>% dplyr::select(-coef.type) %>% mutate_if(is.numeric, ~round(.x, digits = 3)) %>% kable()
```

##### Model A Coefficients (Odds Ratio)
```{r}
broom.mixed::tidy(study_1_mod_india_clmm_a, conf.int = TRUE, exponentiate = TRUE) %>% mutate(p.value = round(p.value, 3)) %>% filter(coef.type != "intercept") %>% dplyr::select(-coef.type) %>% mutate_if(is.numeric, ~round(.x, digits = 3)) %>% kable()
```


### Iran Analysis

Model A: Response ~ Transgression Type * Age + (1 | Subject) +  (1 | Item)   
Model B: Response ~ Transgression Type + Age + (1 | Subject) +  (1 | Item)   

1.  Interaction term did not result in significant improvement to model fit ($\chi^{2}$(1) = 2.5987, *p* = 0.107)  
2.  No significant main effect of transgression type ($\beta$ = 1.478, *z* = 0.897, *p* = 0.37, *CI* = (0.629, 3.474))  
3.  Significant main effect of age ($\beta$ = 2.550, *z* = 3.963, *p* < 0.005, *CI* = (1.605, 4.051))   

#### Mixed Ordinal Regression

##### Model A
```{r}

### Ordinal Mixed Effects Model

# iran model with interaction
study_1_mod_iran_clmm_a <- clmm(as.factor(response) ~ transgression_type * age.c + (1| subject_index) + (1 | item), data = study_1_response_acceptability_iran)
summary(study_1_mod_iran_clmm_a)
```

##### Model B
```{r}
# iran model without interaction
study_1_mod_iran_clmm_b <- clmm(as.factor(response) ~ transgression_type + age.c + (1| subject_index) + (1 | item), data= study_1_response_acceptability_iran)
summary(study_1_mod_iran_clmm_b)
```

##### Model Comparison
```{r}
anova(study_1_mod_iran_clmm_a, study_1_mod_iran_clmm_b, test = 'lrt')
```

##### Model B Coefficients (Log-odds)
```{r}
broom.mixed::tidy(study_1_mod_iran_clmm_b, conf.int = TRUE, exponentiate = FALSE) %>% mutate(p.value = round(p.value, 3)) %>% filter(coef.type != "intercept") %>% dplyr::select(-coef.type) %>% mutate_if(is.numeric, ~round(.x, digits = 3)) %>% kable()
```

##### Model B Coefficients (Odds Ratio)
```{r}
broom.mixed::tidy(study_1_mod_iran_clmm_b, conf.int = TRUE, exponentiate = TRUE) %>% mutate(p.value = round(p.value, 3)) %>% filter(coef.type != "intercept") %>% dplyr::select(-coef.type) %>% mutate_if(is.numeric, ~round(.x, digits = 3)) %>% kable()
```

### Korea Analysis

Model A: Response ~ Transgression Type * Age + (1 | Subject) +  (1 | Item)   
Model B: Response ~ Transgression Type + Age + (1 | Subject) +  (1 | Item)  

1.  Interaction term did not result in significant improvement to model fit ($\chi^{2}$(1) = 0.3473, *p* = 0.5557)  
2.  No significant main effect of transgression type ($\beta$ = 2.869, *z* = 1.051, *p* = 0.293, *CI* = (0.402, 20.466))  
3.  No significant main effect of age ($\beta$ = 2.168, *z* = 1.823, *p* = 0.068, *CI* = (0.943, 4.981))   

#### Mixed Ordinal Regression

##### Model A 
```{r}

### Ordinal Mixed Effects Model

# korea model with interaction
study_1_mod_korea_clmm_a <- clmm(as.factor(response) ~ transgression_type * age.c + (1| subject_index) + (1 | item), data = study_1_response_acceptability_korea)
summary(study_1_mod_korea_clmm_a)
```

##### Model B
```{r}
# korea model without interaction
study_1_mod_korea_clmm_b <- clmm(as.factor(response) ~ transgression_type + age.c + (1| subject_index) + (1 | item), data= study_1_response_acceptability_korea)
summary(study_1_mod_korea_clmm_b)
```

##### Model Comparison
```{r}
anova(study_1_mod_korea_clmm_a, study_1_mod_korea_clmm_b, test = 'lrt')
```

##### Model B Coefficients (Log-odds)
```{r}
broom.mixed::tidy(study_1_mod_korea_clmm_b, conf.int = TRUE, exponentiate = FALSE) %>% mutate(p.value = round(p.value, 3)) %>% filter(coef.type != "intercept") %>% dplyr::select(-coef.type) %>% mutate_if(is.numeric, ~round(.x, digits = 3)) %>% kable()
```

##### Model B Coefficients (Odds Ratio)
```{r}
broom.mixed::tidy(study_1_mod_korea_clmm_b, conf.int = TRUE, exponentiate = TRUE) %>% mutate(p.value = round(p.value, 3)) %>% filter(coef.type != "intercept") %>% dplyr::select(-coef.type) %>% mutate_if(is.numeric, ~round(.x, digits = 3)) %>% kable()
```

## Permissibility ratings by transgression type

```{r}
study_1_response_permissibility_canada <- study_1_response_permissibility_canada %>%
  mutate(subject_index = as.factor(subject_index),
         response = as.numeric(response))

study_1_response_permissibility_india <- study_1_response_permissibility_india %>%
  mutate(subject_index = as.factor(subject_index),
         response = as.numeric(response))

study_1_response_permissibility_india <- study_1_response_permissibility_india %>%
  mutate(subject_index = as.factor(subject_index),
         response = as.numeric(response))

study_1_response_permissibility_korea <- study_1_response_permissibility_korea %>%
  mutate(subject_index = as.factor(subject_index),
         response = as.numeric(response))


```

### Canada

#### If everyone else were doing it

Model A: Answer ~ Task * Age + (1|subid) + (1|item)  
Model B: Answer ~ Task + Age + (1|subid)+ (1|item)    

1.  Interaction term did not result in significant improvement to model fit ($\chi^{2}$(1) = 0.6165, *p* = 0.4323)
2.  Significant difference in acceptability between moral and conventional ($\beta$ = 4.152, *p* = 0.018, *CI* = (1.271, 13.563))
3.  No significant effect of age ($\beta$ = 2.219, *p*  = 0.06, *CI* = (0.942, 5.226))

##### Model A

```{r}



study_1_mod_canada_everyone_a <- glmer(response ~ transgression_type*age.c + (1|subject_index) + (1|item),
                    data = subset(study_1_response_permissibility_canada, hypothetical == "Everyone else"),
                    family = 'binomial') # converges

summary(study_1_mod_canada_everyone_a)



```

##### Model B

```{r}

study_1_mod_canada_everyone_b <- glmer(response ~ transgression_type + age.c + (1|subject_index) + (1|item),
                    data = subset(study_1_response_permissibility_canada, hypothetical == "Everyone else"),
                    family = 'binomial') # converges

summary(study_1_mod_canada_everyone_b)

```

##### Model Comparison

```{r}

anova(study_1_mod_canada_everyone_a, study_1_mod_canada_everyone_b, test = 'lrt')

```

##### Model B Coefficients (Log-odds)
```{r}
broom.mixed::tidy(study_1_mod_canada_everyone_b, conf.int = TRUE, exponentiate = FALSE)  %>% filter(effect != "pars") %>% filter(effect != "ran_pars") %>% dplyr::select(-c(effect, group)) %>% mutate_if(is.numeric, ~round(.x, digits = 3)) %>% kable()
```

##### Model B Coefficients (Odds Ratio)
```{r}
broom.mixed::tidy(study_1_mod_canada_everyone_b, conf.int = TRUE, exponentiate = TRUE)  %>% filter(effect != "pars") %>% filter(effect != "ran_pars") %>% dplyr::select(-c(effect, group)) %>% mutate_if(is.numeric, ~round(.x, digits = 3)) %>% kable()
```

#### Far away

Model A: Answer ~ Task * Age + (1|subid) + (1|item)  
Model B: Answer ~ Task + Age + (1|subid)+ (1|item)    

1.  Interaction term did not result in significant improvement to model fit ($\chi^{2}$(1) = 1.1961  , *p* = 0.2741)
2.  Significant difference in acceptability between moral and conventional ($\beta$ = 4.489, *p* = 0.021, *CI* = (1.253, 16.088))
3.  No significant effect of age ($\beta$ = 0.786, *p*  = 0.448, *CI* = (0.421, 1.466))


##### Model A

```{r}



study_1_mod_canada_faraway_a <- glmer(response ~ transgression_type*age.c + (1|subject_index) + (1|item),
                    data = subset(study_1_response_permissibility_canada, hypothetical == "Faraway country"),
                    family = 'binomial') # converges

summary(study_1_mod_canada_faraway_a)



```

##### Model B

```{r}

study_1_mod_canada_faraway_b <- glmer(response ~ transgression_type + age.c + (1|subject_index) + (1|item),
                    data = subset(study_1_response_permissibility_canada, hypothetical == "Faraway country"),
                    family = 'binomial') # converges

summary(study_1_mod_canada_faraway_b)

```

##### Model Comparison

```{r}

anova(study_1_mod_canada_faraway_a, study_1_mod_canada_faraway_b, test = 'lrt')

```

##### Model B Coefficients (Log-odds)
```{r}
broom.mixed::tidy(study_1_mod_canada_faraway_b, conf.int = TRUE, exponentiate = FALSE)  %>% filter(effect != "pars") %>% filter(effect != "ran_pars") %>% dplyr::select(-c(effect, group)) %>% mutate_if(is.numeric, ~round(.x, digits = 3)) %>% kable()
```

##### Model B Coefficients (Odds Ratio)
```{r}
broom.mixed::tidy(study_1_mod_canada_faraway_b, conf.int = TRUE, exponentiate = TRUE)  %>% filter(effect != "pars") %>% filter(effect != "ran_pars") %>% dplyr::select(-c(effect, group)) %>% mutate_if(is.numeric, ~round(.x, digits = 3)) %>% kable()
```

#### Rule at school

Model A: Answer ~ Task * Age + (1|subid) + (1|item)  
Model B: Answer ~ Task + Age + (1|subid)+ (1|item)    

1.  Interaction term did not result in significant improvement to model fit ($\chi^{2}$(1) = 2.7694  , *p* = 0.09608 )
2.  Significant difference in acceptability between moral and conventional ($\beta$ = 4.632, *p* = 0.026, *CI* = (1.196, 17.939))
3.  Significant effect of age ($\beta$ = 0.365, *p*  = 0.024, *CI* = (0.152, 0.876))

##### Model A

```{r}



study_1_mod_canada_rule_at_school_a <- glmer(response ~ transgression_type*age.c + (1|subject_index) + (1|item),
                    data = subset(study_1_response_permissibility_canada, hypothetical == "Rule at school"),
                    family = 'binomial') # converges

summary(study_1_mod_canada_rule_at_school_a)



```

##### Model B

```{r}

study_1_mod_canada_rule_at_school_b <- glmer(response ~ transgression_type + age.c + (1|subject_index) + (1|item),
                    data = subset(study_1_response_permissibility_canada, hypothetical == "Rule at school"),
                    family = 'binomial') # converges

summary(study_1_mod_canada_rule_at_school_b)

```

##### Model Comparison

```{r}

anova(study_1_mod_canada_rule_at_school_a, study_1_mod_canada_rule_at_school_b, test = 'lrt')

```

##### Model B Coefficients (Log-odds)
```{r}
broom.mixed::tidy(study_1_mod_canada_rule_at_school_b, conf.int = TRUE, exponentiate = FALSE)  %>% filter(effect != "pars") %>% filter(effect != "ran_pars") %>% dplyr::select(-c(effect, group)) %>% mutate_if(is.numeric, ~round(.x, digits = 3)) %>% kable()
```

##### Model B Coefficients (Odds Ratio)
```{r}
broom.mixed::tidy(study_1_mod_canada_rule_at_school_b, conf.int = TRUE, exponentiate = TRUE)  %>% filter(effect != "pars") %>% filter(effect != "ran_pars") %>% dplyr::select(-c(effect, group)) %>% mutate_if(is.numeric, ~round(.x, digits = 3)) %>% kable()
```



#### Combined

##### Model A

```{r}

study_1_mod_canada_combined_a <- glmer(response ~ transgression_type*hypothetical + age.c + (1|subject_index) + (1|item),
                    data = study_1_response_permissibility_canada,
                    family = 'binomial') # converges

summary(study_1_mod_canada_combined_a)

```

##### Model B

```{r}

study_1_mod_canada_combined_b <- glmer(response ~ transgression_type + hypothetical + age.c + (1|subject_index) + (1|item),
                    data = study_1_response_permissibility_canada,
                    family = 'binomial') # converges

summary(study_1_mod_canada_combined_b)

```

##### Model Comparison

```{r}

anova(study_1_mod_canada_combined_a, study_1_mod_canada_combined_b, test = 'lrt')


```

##### Model B Coefficients (Log-odds)
```{r}
broom.mixed::tidy(study_1_mod_canada_combined_b, conf.int = TRUE, exponentiate = FALSE)  %>% filter(effect != "pars") %>% filter(effect != "ran_pars") %>% dplyr::select(-c(effect, group)) %>% mutate_if(is.numeric, ~round(.x, digits = 3)) %>% kable()
```

##### Model B Coefficients (Odds Ratio)
```{r}
broom.mixed::tidy(study_1_mod_canada_combined_b, conf.int = TRUE, exponentiate = TRUE)  %>% filter(effect != "pars") %>% filter(effect != "ran_pars") %>% dplyr::select(-c(effect, group)) %>% mutate_if(is.numeric, ~round(.x, digits = 3)) %>% kable()
```


### India 

#### If everyone else were doing it

Model A: Answer ~ Task * Age + (1|subid) + (1|item)  
Model B: Answer ~ Task + Age + (1|subid)+ (1|item)    

1.  Interaction term did not result in significant improvement to model fit ($\chi^{2}$(1) = 0.1891, *p* = 0.6636)
2.  No significant difference in acceptability between moral and conventional ($\beta$ = 3.059, *p* = 0.097, *CI* = (0.816, 11.463))
3.  No significant effect of age ($\beta$ = 0.859, *p*  = 0.830, *CI* = (0.216, 3.416))

##### Model A

```{r}



study_1_mod_india_everyone_a <- glmer(response ~ transgression_type*age.c + (1|subject_index) + (1|item),
                    data = subset(study_1_response_permissibility_india, hypothetical == "Everyone else"),
                    family = 'binomial') # converges

summary(study_1_mod_india_everyone_a)



```

##### Model B

```{r}

study_1_mod_india_everyone_b <- glmer(response ~ transgression_type + age.c + (1|subject_index) + (1|item),
                    data = subset(study_1_response_permissibility_india, hypothetical == "Everyone else"),
                    family = 'binomial') # converges

summary(study_1_mod_india_everyone_b)

```

##### Model Comparison

```{r}

anova(study_1_mod_india_everyone_a, study_1_mod_india_everyone_b, test = 'lrt')

```

##### Model B Coefficients (Log-odds)
```{r}
broom.mixed::tidy(study_1_mod_india_everyone_b, conf.int = TRUE, exponentiate = FALSE)  %>% filter(effect != "pars") %>% filter(effect != "ran_pars") %>% dplyr::select(-c(effect, group)) %>% mutate_if(is.numeric, ~round(.x, digits = 3)) %>% kable()
```

##### Model B Coefficients (Odds Ratio)
```{r}
broom.mixed::tidy(study_1_mod_india_everyone_b, conf.int = TRUE, exponentiate = TRUE)  %>% filter(effect != "pars") %>% filter(effect != "ran_pars") %>% dplyr::select(-c(effect, group)) %>% mutate_if(is.numeric, ~round(.x, digits = 3)) %>% kable()
```

#### Far away

Model A: Answer ~ Task * Age + (1|subid) + (1|item)  
Model B: Answer ~ Task + Age + (1|subid)+ (1|item)    

1.  Interaction term did not result in significant improvement to model fit ($\chi^{2}$(1) = 0.5568, *p* = 0.4555)
2.  No significant difference in acceptability between moral and conventional ($\beta$ = 0.768, *p* = 0.454, *CI* = (0.384, 1.533))
3.  No significant effect of age ($\beta$ = 0.554, *p*  = 0.074, *CI* = (0.290, 1.059))


##### Model A

```{r}



study_1_mod_india_faraway_a <- glmer(response ~ transgression_type*age.c + (1|subject_index) + (1|item),
                    data = subset(study_1_response_permissibility_india, hypothetical == "Faraway country"),
                    family = 'binomial') # converges

summary(study_1_mod_india_faraway_a)



```

##### Model B

```{r}

study_1_mod_india_faraway_b <- glmer(response ~ transgression_type + age.c + (1|subject_index) + (1|item),
                    data = subset(study_1_response_permissibility_india, hypothetical == "Faraway country"),
                    family = 'binomial') # converges

summary(study_1_mod_india_faraway_b)

```

##### Model Comparison

```{r}

anova(study_1_mod_india_faraway_a, study_1_mod_india_faraway_b, test = 'lrt')

```

##### Model B Coefficients (Log-odds)
```{r}
broom.mixed::tidy(study_1_mod_india_faraway_b, conf.int = TRUE, exponentiate = FALSE)  %>% filter(effect != "pars") %>% filter(effect != "ran_pars") %>% dplyr::select(-c(effect, group)) %>% mutate_if(is.numeric, ~round(.x, digits = 3)) %>% kable()
```

##### Model B Coefficients (Odds Ratio)
```{r}
broom.mixed::tidy(study_1_mod_india_faraway_b, conf.int = TRUE, exponentiate = TRUE)  %>% filter(effect != "pars") %>% filter(effect != "ran_pars") %>% dplyr::select(-c(effect, group)) %>% mutate_if(is.numeric, ~round(.x, digits = 3)) %>% kable()
```

#### Rule at school

Model A: Answer ~ Task * Age + (1|subid) + (1|item)  
Model B: Answer ~ Task + Age + (1|subid)+ (1|item)    

1.  Interaction term did not result in significant improvement to model fit ($\chi^{2}$(1) = 0.0187, *p* = 0.8912)
2.  No significant difference in acceptability between moral and conventional ($\beta$ = 1.489, *p* = 0.206, *CI* = (0.804, 2.760))
3.  No significant effect of age ($\beta$ = 1.158, *p*  = 0.757, *CI* = (0.459, 2.922))

##### Model A

```{r}



study_1_mod_india_rule_at_school_a <- glmer(response ~ transgression_type*age.c + (1|subject_index) + (1|item),
                    data = subset(study_1_response_permissibility_india, hypothetical == "Rule at school"),
                    family = 'binomial') # converges

summary(study_1_mod_india_rule_at_school_a)



```

##### Model B

```{r}

study_1_mod_india_rule_at_school_b <- glmer(response ~ transgression_type + age.c + (1|subject_index) + (1|item),
                    data = subset(study_1_response_permissibility_india, hypothetical == "Rule at school"),
                    family = 'binomial') # converges

summary(study_1_mod_india_rule_at_school_b)

```

##### Model Comparison

```{r}

anova(study_1_mod_india_rule_at_school_a, study_1_mod_india_rule_at_school_b, test = 'lrt')

```

##### Model B Coefficients (Log-odds)
```{r}
broom.mixed::tidy(study_1_mod_india_rule_at_school_b, conf.int = TRUE, exponentiate = FALSE)  %>% filter(effect != "pars") %>% filter(effect != "ran_pars") %>% dplyr::select(-c(effect, group)) %>% mutate_if(is.numeric, ~round(.x, digits = 3)) %>% kable()
```

##### Model B Coefficients (Odds Ratio)
```{r}
broom.mixed::tidy(study_1_mod_india_rule_at_school_b, conf.int = TRUE, exponentiate = TRUE)  %>% filter(effect != "pars") %>% filter(effect != "ran_pars") %>% dplyr::select(-c(effect, group)) %>% mutate_if(is.numeric, ~round(.x, digits = 3)) %>% kable()
```


#### Combined

##### Model A

```{r}

study_1_mod_india_combined_a <- glmer(response ~ transgression_type*hypothetical + age.c + (1|subject_index) + (1|item),
                    data = study_1_response_permissibility_india,
                    family = 'binomial') # converges

summary(study_1_mod_india_combined_a)

```

##### Model B

```{r}

study_1_mod_india_combined_b <- glmer(response ~ transgression_type + hypothetical + age.c + (1|subject_index) + (1|item),
                    data = study_1_response_permissibility_india,
                    family = 'binomial')

summary(study_1_mod_india_combined_b)

```

##### Model Comparison

```{r}

anova(study_1_mod_india_combined_a, study_1_mod_india_combined_b, test = 'lrt')


```

##### Model B Coefficients (Log-odds)
```{r}
broom.mixed::tidy(study_1_mod_india_combined_b, conf.int = TRUE, exponentiate = FALSE)  %>% filter(effect != "pars") %>% filter(effect != "ran_pars") %>% dplyr::select(-c(effect, group)) %>% mutate_if(is.numeric, ~round(.x, digits = 3)) %>% kable()
```

##### Model B Coefficients (Odds Ratio)
```{r}
broom.mixed::tidy(study_1_mod_india_combined_b, conf.int = TRUE, exponentiate = TRUE)  %>% filter(effect != "pars") %>% filter(effect != "ran_pars") %>% dplyr::select(-c(effect, group)) %>% mutate_if(is.numeric, ~round(.x, digits = 3)) %>% kable()
```

### Iran

#### If everyone else were doing it

Model A: Answer ~ Task * Age + (1|subid) + (1|item)  
Model B: Answer ~ Task + Age + (1|subid)+ (1|item)    

1.  Interaction term did not result in significant improvement to model fit ($\chi^{2}$(1) = 0.0849, *p* = 0.7707)
2.  No significant difference in acceptability between moral and conventional ($\beta$ = 2.796, *p* = 0.061, *CI* = (0.953, 8.202))
3.  No significant effect of age ($\beta$ = 1.831, *p*  = 0.416, *CI* = (0.426, 7.870))

##### Model A

```{r}



study_1_mod_iran_everyone_a <- glmer(response ~ transgression_type*age.c + (1|subject_index) + (1|item),
                    data = subset(study_1_response_permissibility_iran, hypothetical == "Everyone else"),
                    family = 'binomial') # converges

summary(study_1_mod_iran_everyone_a)



```

##### Model B

```{r}

study_1_mod_iran_everyone_b <- glmer(response ~ transgression_type + age.c + (1|subject_index) + (1|item),
                    data = subset(study_1_response_permissibility_iran, hypothetical == "Everyone else"),
                    family = 'binomial') # converges

summary(study_1_mod_iran_everyone_b)

```

##### Model Comparison

```{r}

anova(study_1_mod_iran_everyone_a, study_1_mod_iran_everyone_b, test = 'lrt')

```

##### Model B Coefficients (Log-odds)
```{r}
broom.mixed::tidy(study_1_mod_iran_everyone_b, conf.int = TRUE, exponentiate = FALSE)  %>% filter(effect != "pars") %>% filter(effect != "ran_pars") %>% dplyr::select(-c(effect, group)) %>% mutate_if(is.numeric, ~round(.x, digits = 3)) %>% kable()
```

##### Model B Coefficients (Odds Ratio)
```{r}
broom.mixed::tidy(study_1_mod_iran_everyone_b, conf.int = TRUE, exponentiate = TRUE)  %>% filter(effect != "pars") %>% filter(effect != "ran_pars") %>% dplyr::select(-c(effect, group)) %>% mutate_if(is.numeric, ~round(.x, digits = 3)) %>% kable()
```

#### Far away

Model A: Answer ~ Task * Age + (1|subid) + (1|item)  
Model B: Answer ~ Task + Age + (1|subid)+ (1|item)    

1.  Interaction term did not result in significant improvement to model fit ($\chi^{2}$(1) = 7e-04, *p* = 0.9785)
2.  No significant difference in acceptability between moral and conventional ($\beta$ = 15.555, *p* = 0.053, *CI* = (0.961, 251.796))
3.  No significant effect of age ($\beta$ = 1.821, *p*  = 0.494, *CI* = (0.326, 10.159))

##### Model A

```{r}



study_1_mod_iran_faraway_a <- glmer(response ~ transgression_type*age.c + (1|subject_index) + (1|item),
                    data = subset(study_1_response_permissibility_iran, hypothetical == "Faraway country"),
                    family = 'binomial') # converges

summary(study_1_mod_iran_faraway_a)



```

##### Model B

```{r}

study_1_mod_iran_faraway_b <- glmer(response ~ transgression_type + age.c + (1|subject_index) + (1|item),
                    data = subset(study_1_response_permissibility_iran, hypothetical == "Faraway country"),
                    family = 'binomial') # converges

summary(study_1_mod_iran_faraway_b)

```

##### Model Comparison

```{r}

anova(study_1_mod_iran_faraway_a, study_1_mod_iran_faraway_b, test = 'lrt')

```

##### Model B Coefficients (Log-odds)
```{r}
broom.mixed::tidy(study_1_mod_iran_faraway_b, conf.int = TRUE, exponentiate = FALSE)  %>% filter(effect != "pars") %>% filter(effect != "ran_pars") %>% dplyr::select(-c(effect, group)) %>% mutate_if(is.numeric, ~round(.x, digits = 3)) %>% kable()
```

##### Model B Coefficients (Odds Ratio)
```{r}
broom.mixed::tidy(study_1_mod_iran_faraway_b, conf.int = TRUE, exponentiate = TRUE)  %>% filter(effect != "pars") %>% filter(effect != "ran_pars") %>% dplyr::select(-c(effect, group)) %>% mutate_if(is.numeric, ~round(.x, digits = 3)) %>% kable()
```

#### Rule at school

Model A: Answer ~ Task * Age + (1|subid) + (1|item)  
Model B: Answer ~ Task + Age + (1|subid)+ (1|item)    

1. Interaction term results in a significant improvement to model fit ($\chi^{2}$(1) = 4.1248, *p* = 0.04226)
2. No further significant contrasts from the default model output.

##### Model A

```{r}



study_1_mod_iran_rule_at_school_a <- glmer(response ~ transgression_type*age.c + (1|subject_index) + (1|item),
                    data = subset(study_1_response_permissibility_iran, hypothetical == "Rule at school"),
                    family = 'binomial') # converges

summary(study_1_mod_iran_rule_at_school_a)



```

##### Model B

```{r}

study_1_mod_iran_rule_at_school_b <- glmer(response ~ transgression_type + age.c + (1|subject_index) + (1|item),
                    data = subset(study_1_response_permissibility_iran, hypothetical == "Rule at school"),
                    family = 'binomial') # converges

summary(study_1_mod_iran_rule_at_school_b)

```


##### Model Comparison

```{r}

anova(study_1_mod_iran_rule_at_school_a, study_1_mod_iran_rule_at_school_b, test = 'lrt')

```

##### Model A Coefficients (Log-odds)
```{r}
broom.mixed::tidy(study_1_mod_iran_rule_at_school_a, conf.int = TRUE, exponentiate = FALSE)  %>% filter(effect != "pars") %>% filter(effect != "ran_pars") %>% dplyr::select(-c(effect, group)) %>% mutate_if(is.numeric, ~round(.x, digits = 3)) %>% kable()
```

##### Model A Coefficients (Odds Ratio)
```{r}
broom.mixed::tidy(study_1_mod_iran_rule_at_school_a, conf.int = TRUE, exponentiate = TRUE)  %>% filter(effect != "pars") %>% filter(effect != "ran_pars") %>% dplyr::select(-c(effect, group)) %>% mutate_if(is.numeric, ~round(.x, digits = 3)) %>% kable()
```


#### Combined

##### Model A

```{r}

study_1_mod_iran_combined_a <- glmer(response ~ transgression_type*hypothetical + age.c + (1|subject_index) + (1|item),
                    data = study_1_response_permissibility_iran,
                    family = 'binomial') # converges

summary(study_1_mod_iran_combined_a)

```

##### Model B

```{r}

study_1_mod_iran_combined_b <- glmer(response ~ transgression_type + hypothetical + age.c + (1|subject_index) + (1|item),
                    data = study_1_response_permissibility_iran,
                    family = 'binomial') # converges

summary(study_1_mod_iran_combined_b)

```

##### Model Comparison

```{r}

anova(study_1_mod_iran_combined_a, study_1_mod_iran_combined_b, test = 'lrt')


```

##### Model B Coefficients (Log-odds)
```{r}
broom.mixed::tidy(study_1_mod_iran_combined_b, conf.int = TRUE, exponentiate = FALSE)  %>% filter(effect != "pars") %>% filter(effect != "ran_pars") %>% dplyr::select(-c(effect, group)) %>% mutate_if(is.numeric, ~round(.x, digits = 3)) %>% kable()
```

##### Model B Coefficients (Odds Ratio)
```{r}
broom.mixed::tidy(study_1_mod_iran_combined_b, conf.int = TRUE, exponentiate = TRUE)  %>% filter(effect != "pars") %>% filter(effect != "ran_pars") %>% dplyr::select(-c(effect, group)) %>% mutate_if(is.numeric, ~round(.x, digits = 3)) %>% kable()
```


### Korea

#### If everyone else were doing it

Model A: Answer ~ Task * Age + (1|subid) + (1|item)  
Model B: Answer ~ Task + Age + (1|subid)+ (1|item)    

1.  Interaction term did not result in significant improvement to model fit ($\chi^{2}$(1) = 0.8272, *p* = 0.3631)
2.  Significant difference in acceptability between moral and conventional ($\beta$ = 5.641, *p* = 0.006, *CI* = (1.640, 19.396))
3.  Significant effect of age ($\beta$ = 5.894, *p*  = 0.013, *CI* = (1.459, 23.816))

##### Model A

```{r}



study_1_mod_korea_everyone_a <- glmer(response ~ transgression_type*age.c + (1|subject_index) + (1|item),
                    data = subset(study_1_response_permissibility_korea, hypothetical == "Everyone else"),
                    family = 'binomial') # converges

summary(study_1_mod_korea_everyone_a)



```

##### Model B

```{r}

study_1_mod_korea_everyone_b <- glmer(response ~ transgression_type + age.c + (1|subject_index) + (1|item),
                    data = subset(study_1_response_permissibility_korea, hypothetical == "Everyone else"),
                    family = 'binomial') # converges

summary(study_1_mod_korea_everyone_b)

```

##### Model Comparison

```{r}

anova(study_1_mod_korea_everyone_a, study_1_mod_korea_everyone_b, test = 'lrt')

```

##### Model B Coefficients (Log-odds)
```{r}
broom.mixed::tidy(study_1_mod_korea_everyone_b, conf.int = TRUE, exponentiate = FALSE)  %>% filter(effect != "pars") %>% filter(effect != "ran_pars") %>% dplyr::select(-c(effect, group)) %>% mutate_if(is.numeric, ~round(.x, digits = 3)) %>% kable()
```

##### Model B Coefficients (Odds Ratio)
```{r}
broom.mixed::tidy(study_1_mod_korea_everyone_b, conf.int = TRUE, exponentiate = TRUE)  %>% filter(effect != "pars") %>% filter(effect != "ran_pars") %>% dplyr::select(-c(effect, group)) %>% mutate_if(is.numeric, ~round(.x, digits = 3)) %>% kable()
```

#### Far away

Model A: Answer ~ Task * Age + (1|subid) + (1|item)  
Model B: Answer ~ Task + Age + (1|subid)+ (1|item)    

1.  Interaction term did not result in significant improvement to model fit ($\chi^{2}$(1) = 2.694, *p* = 0.1007)
2.  No significant difference in acceptability between moral and conventional ($\beta$ = 4.482, *p* = 0.108, *CI* = (0.719, 27.928))
3.  Significant effect of age ($\beta$ = 7.021, *p*  = 0.049, *CI* = (1.004, 49.115))


##### Model A

```{r}



study_1_mod_korea_faraway_a <- glmer(response ~ transgression_type*age.c + (1|subject_index) + (1|item),
                    data = subset(study_1_response_permissibility_korea, hypothetical == "Faraway country"),
                    family = 'binomial') # converges

summary(study_1_mod_korea_faraway_a)



```

##### Model B

```{r}

study_1_mod_korea_faraway_b <- glmer(response ~ transgression_type + age.c + (1|subject_index) + (1|item),
                    data = subset(study_1_response_permissibility_korea, hypothetical == "Faraway country"),
                    family = 'binomial') # converges

summary(study_1_mod_korea_faraway_b)

```

##### Model Comparison

```{r}

anova(study_1_mod_korea_faraway_a, study_1_mod_korea_faraway_b, test = 'lrt')

```

##### Model B Coefficients (Log-odds)
```{r}
broom.mixed::tidy(study_1_mod_korea_faraway_b, conf.int = TRUE, exponentiate = FALSE)  %>% filter(effect != "pars") %>% filter(effect != "ran_pars") %>% dplyr::select(-c(effect, group)) %>% mutate_if(is.numeric, ~round(.x, digits = 3)) %>% kable()
```

##### Model B Coefficients (Odds Ratio)
```{r}
broom.mixed::tidy(study_1_mod_korea_faraway_b, conf.int = TRUE, exponentiate = TRUE)  %>% filter(effect != "pars") %>% filter(effect != "ran_pars") %>% dplyr::select(-c(effect, group)) %>% mutate_if(is.numeric, ~round(.x, digits = 3)) %>% kable()
```

#### Rule at school

##### Model A

```{r}



study_1_mod_korea_rule_at_school_a <- glmer(response ~ transgression_type*age.c + (1|subject_index) + (1|item),
                    data = subset(study_1_response_permissibility_korea, hypothetical == "Rule at school"),
                    family = 'binomial') # converges

summary(study_1_mod_korea_rule_at_school_a)



```

##### Model B

```{r}

study_1_mod_korea_rule_at_school_b <- glmer(response ~ transgression_type + age.c + (1|subject_index) + (1|item),
                    data = subset(study_1_response_permissibility_korea, hypothetical == "Rule at school"),
                    family = 'binomial') # converges

summary(study_1_mod_korea_rule_at_school_b)

```

##### Model Comparison

```{r}

anova(study_1_mod_korea_rule_at_school_a, study_1_mod_korea_rule_at_school_b, test = 'lrt')

```

##### Model B Coefficients (Log-odds)
```{r}
broom.mixed::tidy(study_1_mod_korea_rule_at_school_b, conf.int = TRUE, exponentiate = FALSE)  %>% filter(effect != "pars") %>% filter(effect != "ran_pars") %>% dplyr::select(-c(effect, group)) %>% mutate_if(is.numeric, ~round(.x, digits = 3)) %>% kable()
```

##### Model B Coefficients (Odds Ratio)
```{r}
broom.mixed::tidy(study_1_mod_korea_rule_at_school_b, conf.int = TRUE, exponentiate = TRUE)  %>% filter(effect != "pars") %>% filter(effect != "ran_pars") %>% dplyr::select(-c(effect, group)) %>% mutate_if(is.numeric, ~round(.x, digits = 3)) %>% kable()
```

#### Combined

##### Model A

```{r}

study_1_mod_korea_combined_a <- glmer(response ~ transgression_type*hypothetical + age.c + (1|subject_index) + (1|item),
                    data = study_1_response_permissibility_korea,
                    family = 'binomial') # converges

summary(study_1_mod_korea_combined_a)

```

##### Model B

```{r}

study_1_mod_korea_combined_b <- glmer(response ~ transgression_type + hypothetical + age.c + (1|subject_index) + (1|item),
                    data = study_1_response_permissibility_korea,
                    family = 'binomial') # converges

summary(study_1_mod_korea_combined_b)

```

##### Model Comparison

```{r}

anova(study_1_mod_korea_combined_a, study_1_mod_korea_combined_b, test = 'lrt')


```

##### Model B Coefficients (Log-odds)
```{r}
broom.mixed::tidy(study_1_mod_korea_combined_b, conf.int = TRUE, exponentiate = FALSE)  %>% filter(effect != "pars") %>% filter(effect != "ran_pars") %>% dplyr::select(-c(effect, group)) %>% mutate_if(is.numeric, ~round(.x, digits = 3)) %>% kable()
```

##### Model B Coefficients (Odds Ratio)
```{r}
broom.mixed::tidy(study_1_mod_korea_combined_b, conf.int = TRUE, exponentiate = TRUE)  %>% filter(effect != "pars") %>% filter(effect != "ran_pars") %>% dplyr::select(-c(effect, group)) %>% mutate_if(is.numeric, ~round(.x, digits = 3)) %>% kable()
```

## Modeling Response by Cultural Site

```{r, include = FALSE}

study_1_response_acceptability_canada <- study_1_response_acceptability_canada %>%
  mutate(country = "canada") %>% mutate(subject_index = factor(subject_index),
                                        response = as.numeric(response)) %>%
  mutate(country = factor(country))

study_1_response_acceptability_iran <- study_1_response_acceptability_iran %>%
  mutate(country = "iran") %>% mutate(subject_index = factor(subject_index),
                                        response = as.numeric(response)) %>%
  mutate(country = factor(country))

study_1_response_acceptability_india <- study_1_response_acceptability_india %>%
  mutate(country = "india") %>% mutate(subject_index = factor(subject_index),
                                        response = as.numeric(response)) %>%
  mutate(country = factor(country))

study_1_response_acceptability_korea <- study_1_response_acceptability_korea %>%
  mutate(country = "korea") %>% mutate(subject_index = factor(subject_index),
                                        response = as.numeric(response)) %>%
  mutate(country = factor(country))

study_1_response_acceptability_all <- study_1_response_acceptability_canada %>%
  bind_rows(study_1_response_acceptability_iran,
            study_1_response_acceptability_india,
            study_1_response_acceptability_korea) %>%
  mutate(country = factor(country, levels = c("canada", "india", "iran", "korea"))) %>%
  mutate(country_cat = case_when(country == "canada" ~ "western",
                                 TRUE ~ "not-western")) %>%
  mutate(country_cat = factor(country_cat, levels = c("western", "not-western")))

```

### Canada vs Other Cultural Sites

#### Model 1

Model 1: Answer ~ Cultural Site + (1|subid) + (1|item)  
   

1.  Significant difference in acceptability between Canada and India ($\beta$ = 0.089, *z* = -8.148, *p* < 0.001, *CI* = (0.050, 0.160))
2.  Significant difference in acceptability between Canada and Iran ($\beta$ = 0.0678, *z* = -9.319	, *p* < 0.001, *CI* = (0.038, 0.119))
3.  Significant difference in acceptability between Canada and Korea ($\beta$ = 0.273, *z* = -3.644, *p* < 0.001, *CI* = (0.136, 0.548))

```{r}


study_1_mod_acceptability_all <- clmm(as.factor(response) ~ country + (1| subject_index) + (1|item), data = study_1_response_acceptability_all)

summary(study_1_mod_acceptability_all)

broom.mixed::tidy(study_1_mod_acceptability_all, conf.int = TRUE, exponentiate = TRUE) %>% filter(coef.type != "intercept") %>% dplyr::select(-coef.type) %>% mutate_if(is.numeric, ~round(.x, digits = 3)) %>% kable()

```


#### Model 2

Model 1: Answer ~ Cultural Site + (1|subid) + (1|item)  
   

1.  Significant difference in acceptability between Western and non-Western sites ($\beta$ = 0.097, *z* = -9.595, *p* < 0.001, *CI* = (0.06, 0.156))

```{r}

study_1_mod_acceptability_all_2 <- clmm(as.factor(response) ~ country_cat + (1| subject_index) + (1|item), data = study_1_response_acceptability_all)

summary(study_1_mod_acceptability_all_2)

broom.mixed::tidy(study_1_mod_acceptability_all_2, conf.int = TRUE, exponentiate = TRUE) %>% filter(coef.type != "intercept") %>% dplyr::select(-coef.type) %>% mutate_if(is.numeric, ~round(.x, digits = 3)) %>% kable()

# study_1_response_acceptability_all %>% mutate(country = factor(country, labels = c("Canada", "India", "Iran", "Korea"))) %>% ggplot(aes(x = response)) + geom_histogram() + facet_grid(~country) + ggtitle("Frequency distribution of response by cultural site")

```

# Study 2

```{r}
study2_data <- read.csv("data/cleaned_data/study2_mc_iran.csv") %>% 
  mutate(item = ifelse(item == "toys ", "toys", as.character(item)), 
         item = ifelse(task_num == "conv4.8", "toys", as.character(item)), 
         item = ifelse(task_num == "reigious1.8", "push", as.character(item)), 
         task = ifelse(item == "push", "moral", as.character(task)), 
         q_kind_label = ifelse(q_kind_label == "Farawary country", "Faraway country", 
                               ifelse(q_kind_label == "Non-muslim", "Non-Muslim", as.character(q_kind_label))))

study2_data %<>%
  mutate(subid = factor(subid), 
         task = factor(task), 
         item = factor(item), 
         answer = as.numeric(answer), 
         site = factor(site), 
         age.c = as.vector(scale(age, center = TRUE, scale = TRUE)), 
         age.group = as.numeric(as.character(age.group)))%>%
  mutate(age.bin = ifelse(age.group < 7, "5-6", 
                          ifelse((age.group >= 7 & age.group < 9), "7-8", "9-10")))

study_2_data <- read.csv("data/cleaned_data/study2_mc_iran.csv") %>% 
  mutate(item = ifelse(item == "toys ", "toys", as.character(item)), 
         item = ifelse(task_num == "conv4.8", "toys", as.character(item)), 
         item = ifelse(task_num == "reigious1.8", "push", as.character(item)), 
         task = ifelse(item == "push", "moral", as.character(task)), 
         q_kind_label = ifelse(q_kind_label == "Farawary country", "Faraway country", 
                               ifelse(q_kind_label == "Non-muslim", "Non-Muslim", as.character(q_kind_label)))) %>%
  mutate(subid = factor(subid), 
         task = factor(task), 
         item = factor(item), 
         answer = as.numeric(answer), 
         site = factor(site), 
         age.c = as.vector(scale(age, center = TRUE, scale = TRUE)), 
         age.group = as.numeric(as.character(age.group)))%>%
  mutate(age.bin = ifelse(age.group < 7, "5-6", 
                          ifelse((age.group >= 7 & age.group < 9), "7-8", "9-10")))

study_2_subject_index <- study_2_data %>%
  dplyr::select(subid) %>%
  distinct() %>% 
  mutate(subject_index = row_number())

study_2_data <- study_2_data %>% merge(study_2_subject_index, by = "subid") %>%
  dplyr::select(subject_index,  sex, age, age.c, transgression_type = task, item, q_kind_label, response = answer) %>%
  arrange(subject_index) %>%
  mutate(transgression_type = factor(transgression_type, levels = c("moral", "conv", "conv.iran", "religious")))

study_2_response_acceptability <- study_2_data %>% filter(q_kind_label == "Severity rating")
study_2_response_permissibility <- study_2_data %>% filter(q_kind_label != "Severity rating" &
                                                                    q_kind_label != "Haram" &
                                                                    q_kind_label != "Illegal" &
                                                                    q_kind_label != "Zesht")
study_2_response_haram <- study_2_data %>% filter(q_kind_label == "Haram")
study_2_response_illegal <- study_2_data %>% filter(q_kind_label == "Illegal")
study_2_response_zesht <- study_2_data %>% filter(q_kind_label == "Zesht")

```

## Iran Analysis

```{r, include = FALSE}

# Analyses of differences in rating between moral and conventional transgressions: Within-country
# Pre-registered mixed-effects model: Rating ~ Transgression type (moral; conventional; conv.iran, religious)*Age + (Transgression type|Subject) + (age|item).

# We will iteratively remove item slopes, then subject slopes, then will remove item effects altogether if necessary.
# set up a df for ratings

ratings.ms <- study2_data %>%
  filter(q_kind == 0)%>%
  mutate(task = factor(task, levels = c("moral", "conv", "conv.iran", "religious")))

set.seed(1234) #set random seed for reproducibility
```

### Acceptability ratings of moral and conventional items 


#### Mixed Ordinal Regression  

Model A: Response ~ Transgression Type * Age + (1|subid) + (1|item)  

Model B: Response ~ Transgression Type + Age + (1|subid) + (1|item)  

1.  Interaction term did not result in significant improvement to model fit ($\chi^{2}$(3) = 5.9235, *p* = 0.1154)  
2.  No significant difference between MORAL and CONVENTIONAL items ($\beta$ = 1.032, *z* = 0.058, *p* = .954, *CI* = (0.361, 2.951))  
3.  Significant difference between MORAL and CONVENTIONAL IRAN items ($\beta$ = 3.269, *z* = 2.226, *p* = .026, *CI* = (1.152, 9.277))  
4.  No significant difference between MORAL and RELIGIOUS items ($\beta$ = 0.980, *z* = -0.038, *p* = .970, *CI* = (0.343, 2.799))  
5.  Significant effect of age ($\beta$ = 1.634, *t* = 3.177, *p* = .001, *CI* = (1.207, 2.212))  

##### Model A
```{r}

# Ordinal Mixed Model

# iran study 2 model with interaction
study_2_mod_clmm_a <- clmm(as.factor(response) ~ transgression_type * age.c + (1| subject_index) + (1|item), data = study_2_response_acceptability)
summary(study_2_mod_clmm_a)
```

##### Model B
```{r}
# iran study 2 model without interaction
study_2_mod_clmm_b <- clmm(as.factor(response) ~ transgression_type + age.c + (1| subject_index) + (1|item), data = study_2_response_acceptability)
summary(study_2_mod_clmm_b)
```

##### Model Comparison
```{r}
anova(study_2_mod_clmm_a, study_2_mod_clmm_b, test = 'lrt')
```

##### Model B Coefficients (Log-odds)
```{r}
broom.mixed::tidy(study_2_mod_clmm_b, conf.int = TRUE, exponentiate = FALSE) %>% mutate(p.value = round(p.value, 3)) %>% filter(coef.type != "intercept") %>% dplyr::select(-coef.type) %>% mutate_if(is.numeric, ~round(.x, digits = 3)) %>% kable()
```

##### Model B Coefficients (Odds Ratio)
```{r}
broom.mixed::tidy(study_2_mod_clmm_b, conf.int = TRUE, exponentiate = TRUE) %>% mutate(p.value = round(p.value, 3)) %>% filter(coef.type != "intercept") %>% dplyr::select(-coef.type) %>% mutate_if(is.numeric, ~round(.x, digits = 3)) %>% kable()
```

### Permissibility ratings by transgression type

Pre-registration:  

Response (yes/no) ~ Transgression type (moral; conventional; conventional-Iran; religious) *Age + (transgression type|subject) +(age|item).  

Once again we will begin with a maximal random effects structure, and iteratively remove coefficients until the model converges. We will begin first by removing the slope of the item effect, then of subject, and if necessary removing the item effect altogether.

```{r, include = FALSE}
# set up a data frame
acceptability.ms <- study2_data %>%
  filter(q_kind != 0)%>%
  mutate(task = factor(task, levels = c("moral", "conv", "conv.iran", "religious")))
```

#### If everyone else were doing it

Model A: Answer ~ Task * Age + (1|subid)   
Model B: Answer ~ Task + Age + (1|subid)    

**Note** Model will not converge with item random effect. 

1.  Interaction term did not result in significant improvement to model fit ($\chi^{2}$(3) = 6.1448, *p* = 0.1048)
2.  Significant difference in acceptability between moral and conventional ($\beta$ = 3.534, *p* < .0005)
3.  Significant difference in acceptability between moral and conventional-Iran ($\beta$ = 6.307, *p* < .0005)
4.  No significant difference in acceptability between moral and religious ($\beta$ = 1.142, *p* = 0.697)
5.  Significant effect of age ($\beta$ = 2.520, *p* < .0005)

##### Model A
```{r}
everyone <- glmer(answer ~ task*age.c + (1|subid),
                    data = subset(acceptability.ms, q_kind == 3),
                    family = 'binomial') # converges
summary(everyone)
```

##### Model B
```{r}
## is the interaction between age and task significant?
everyone.base <- glmer(answer ~ task+age.c + (1|subid),
                    data = subset(acceptability.ms, q_kind == 3), 
                    family = 'binomial') # converges
summary(everyone.base)
```

##### Model Comparison
```{r}
anova(everyone.base, everyone, test = 'lrt') ## the interaction does not significantly improve the fit, so we drop it from the model
```

##### Model B Coefficients (Log-odds)
```{r}
broom.mixed::tidy(everyone.base, conf.int = TRUE, exponentiate = FALSE)  %>% filter(effect != "pars") %>% filter(effect != "ran_pars") %>% dplyr::select(-c(effect, group)) %>% mutate_if(is.numeric, ~round(.x, digits = 3)) %>% kable()
```

##### Model B Coefficients (Odds Ratio)
```{r}
broom.mixed::tidy(everyone.base, conf.int = TRUE, exponentiate = TRUE)  %>% filter(effect != "pars") %>% filter(effect != "ran_pars") %>% dplyr::select(-c(effect, group)) %>% mutate_if(is.numeric, ~round(.x, digits = 3)) %>% kable()
```

#### Far away

Model A: Answer ~ Task * Age + (1|subid)  
Model B: Answer ~ Task + Age + (1|subid)   

**Note** Model will not converge with item random effect. 

1.  Interaction term did not result in significant improvement to model fit ($\chi^{2}$(3) = 3.9985, *p* = 0.2616)
2.  Significant difference in acceptability between moral and conventional ($\beta$ = 1.996, *p* = 0.027)
3.  Significant difference in acceptability between moral and conventional-Iran ($\beta$ = 4.545, *p* < .0005)
4.  Significant difference in acceptability between moral and religious ($\beta$ = 5.490, *p* < .0005)
5.  Significant effect of age ($\beta$ = 2.006, *p* = .002)

##### Model A
```{r}
faraway <- glmer(answer ~ task*age.c + (1|subid),
                    data = subset(acceptability.ms, q_kind == 1),
                    family = 'binomial') # converges
summary(faraway)
```

##### Model B
```{r}
## is the interaction between age and task significant?
faraway.base <- glmer(answer ~ task+age.c + (1|subid),
                    data = subset(acceptability.ms, q_kind == 1), 
                    family = 'binomial') # converges
summary(faraway.base)
```

##### Model Comparison
```{r}
anova(faraway.base, faraway, test = 'lrt') ## the interaction does not significantly improve the fit, so we drop it from the model
```

##### Model B Coefficients (Log-odds)
```{r}
##summary of main effects
broom.mixed::tidy(faraway.base, conf.int = TRUE, exponentiate = FALSE)  %>% filter(effect != "pars") %>% filter(effect != "ran_pars") %>% dplyr::select(-c(effect, group)) %>% mutate_if(is.numeric, ~round(.x, digits = 3)) %>% kable()
```


##### Model B Coefficients (Odds Ratio)
```{r}
##summary of main effects
broom.mixed::tidy(faraway.base, conf.int = TRUE, exponentiate = TRUE)  %>% filter(effect != "pars") %>% filter(effect != "ran_pars") %>% dplyr::select(-c(effect, group)) %>% mutate_if(is.numeric, ~round(.x, digits = 3)) %>% kable()
```

#### Rule at school

Model A: Answer ~ Task * Age + (1|subid)  
Model B: Answer ~ Task + Age + (1|subid)  

**Note** Model will not converge with item random effect. 

1.  Interaction term did not result in significant improvement to model fit ($\chi^{2}$(3) = 1.083, *p* = 0.7812)
2.  Significant difference in acceptability between moral and conventional ($\beta$ = 2.487, *p* < .001)
3.  Significant difference in acceptability between moral and conventional-Iran ($\beta$ = 4.257, *p* < .0005)
4.  Significant difference in acceptability between moral and religious ($\beta$ = 2.718, *p* < .0005)
5.  Significant effect of age ($\beta$ = 2.085, *p* = .001)

##### Model A
```{r}
rule <- glmer(answer ~ task*age.c + (1|subid),
                    data = subset(acceptability.ms, q_kind == 2),
                    family = 'binomial') # converges
summary(rule)
```

##### Model B
```{r}
## is the interaction between age and task significant?
rule.base <- glmer(answer ~ task+age.c + (1|subid),
                    data = subset(acceptability.ms, q_kind == 2), 
                    family = 'binomial') # converges
summary(rule.base)
```

##### Model Comparison
```{r}
anova(rule.base, rule, test = 'lrt') ## the interaction does not significantly improve the fit, so we drop it from the model
```

##### Model B Coefficients (Log-odds)
```{r}
##summary of main effects
broom.mixed::tidy(rule.base, conf.int = TRUE, exponentiate = FALSE)  %>% filter(effect != "pars") %>% filter(effect != "ran_pars") %>% dplyr::select(-c(effect, group)) %>% mutate_if(is.numeric, ~round(.x, digits = 3)) %>% kable()
```

##### Model B Coefficients (Odds Ratio)
```{r}
##summary of main effects
broom.mixed::tidy(rule.base, conf.int = TRUE, exponentiate = TRUE)  %>% filter(effect != "pars") %>% filter(effect != "ran_pars") %>% dplyr::select(-c(effect, group)) %>% mutate_if(is.numeric, ~round(.x, digits = 3)) %>% kable()
```


#### Foreigner

Model A: Answer ~ Task * Age + (1|subid)   
Model B: Answer ~ Task + Age + (1|subid)  

**Note** Model will not converge with item random effect. 

1.  Interaction term resulted in significant improvement to model fit ($\chi^{2}(3)$ = 13.562, *p* = 0.003567)

##### Model A
```{r}
foreigner <- glmer(answer ~ task*age.c + (1|subid),
                    data = subset(acceptability.ms, q_kind == 4),
                    family = 'binomial', 
                   control=glmerControl(optimizer="bobyqa",
                                             optCtrl=list(maxfun=2e4))) # converges
summary(foreigner)
```

##### Model B
```{r}

## is the interaction between age and task significant?
foreigner.base <- glmer(answer ~ task+age.c + (1|subid),
                    data = subset(acceptability.ms, q_kind == 4), 
                    family = 'binomial', 
                    control=glmerControl(optimizer="bobyqa",
                                             optCtrl=list(maxfun=2e4))) # converges
summary(foreigner.base)
```

##### Model Comparison
```{r}
anova(foreigner.base, foreigner, test = 'lrt')
```

##### Model A Coefficient (Log-odds)
```{r}
##summary of main effects
car::Anova(foreigner, type = "III")
broom.mixed::tidy(foreigner, conf.int = TRUE, exponentiate = FALSE)  %>% filter(effect != "pars") %>% filter(effect != "ran_pars") %>% dplyr::select(-c(effect, group)) %>% mutate_if(is.numeric, ~round(.x, digits = 3)) %>% kable()
```

##### Model A Coefficient (Odds Ratio)
```{r}
##summary of main effects
car::Anova(foreigner, type = "III")
broom.mixed::tidy(foreigner, conf.int = TRUE, exponentiate = TRUE)  %>% filter(effect != "pars") %>% filter(effect != "ran_pars") %>% dplyr::select(-c(effect, group)) %>% mutate_if(is.numeric, ~round(.x, digits = 3)) %>% kable()
```

#### Non-Muslim

Model A: Answer ~ Task * Age + (1|subid)  
Model B: Answer ~ Task + Age + (1|subid)  

**Note** Model will not converge with item random effect. 

1.  Interaction term resulted in significant improvement to model fit ($\chi^{2}$(3) = 15.374, *p* = 0.001524)

##### Model A
```{r}
muslim <- glmer(answer ~ task*age.c + (1|subid),
                    data = subset(acceptability.ms, q_kind == 5),
                    family = 'binomial', 
                   control=glmerControl(optimizer="bobyqa",
                                             optCtrl=list(maxfun=2e4))) # converges
summary(muslim)
```

##### Model B
```{r}
## is the interaction between age and task significant?
muslim.base <- glmer(answer ~ task+age.c + (1|subid),
                    data = subset(acceptability.ms, q_kind == 5), 
                    family = 'binomial', 
                    control=glmerControl(optimizer="bobyqa",
                                             optCtrl=list(maxfun=2e4))) # converges
summary(muslim.base)
```

##### Model Comparison
```{r}
anova(muslim.base, muslim, test = 'lrt') 
```

##### Model A Coefficient (Log-odds)
```{r}
##summary of main effects
car::Anova(muslim, type = "III")
broom.mixed::tidy(muslim, conf.int = TRUE, exponentiate = FALSE)  %>% filter(effect != "pars") %>% filter(effect != "ran_pars") %>% dplyr::select(-c(effect, group)) %>% mutate_if(is.numeric, ~round(.x, digits = 3)) %>% kable()
```

##### Model A Coefficient (Odds Ratio)
```{r}
##summary of main effects
car::Anova(muslim, type = "III")
broom.mixed::tidy(muslim, conf.int = TRUE, exponentiate = TRUE)  %>% filter(effect != "pars") %>% filter(effect != "ran_pars") %>% dplyr::select(-c(effect, group)) %>% mutate_if(is.numeric, ~round(.x, digits = 3)) %>% kable()
```

### Judgements of transgressions as illegal, rude, or religiously forbidden

#### Haram

Model A: Answer ~ Task * Age + (1|subid)  
Model B: Answer ~ Task + Age + (1|subid)  

**Note** Model will not converge with item random effect. 

1.  Interaction term did not result in significant improvement to model fit ($\chi^{2}$(3) = 5.5925, *p* = .1332)
2.  No significant difference between moral and conventional ($\beta$ = 0.665, *t* = -1.460, *p* =.144, *CI* = (0.384, 1.150))
3.  Significant difference between moral and conventional-Iran ($\beta$ = 0.362, *t* = -3.497, *p* < .0005, *CI* = (0.205, 0.639))
4.  Significant difference between moral and religious ($\beta$ = 7.536, *t* = 6.950, *p* < .0005, *CI* = (4.263, 13.314))
5.  Significant effect of age ($\beta$ = 0.271, *t* = -4.723, *p* < .0005, *CI* = (0.158, 0.466))


##### Model A
```{r}
## we're going to make the reference group here reflect predictions
tmp <- acceptability.ms %>%
  mutate(task = factor(task, levels = c("moral", "conv", "conv.iran", "religious")))

haram <- glmer(answer ~ task*age.c + (1|subid),
                    data = subset(tmp, q_kind == 6),
                    family = 'binomial', 
                   control=glmerControl(optimizer="bobyqa",
                                             optCtrl=list(maxfun=2e4))) # converges

summary(haram)
```

##### Model B
```{r}
## is the interaction between age and task significant?
haram.base <- glmer(answer ~ task+age.c + (1|subid),
                    data = subset(tmp, q_kind == 6), 
                    family = 'binomial', 
                    control=glmerControl(optimizer="bobyqa",
                                             optCtrl=list(maxfun=2e4))) # converges
summary(haram.base)
```

##### Model Comparison
```{r}
anova(haram.base,haram, test = 'lrt') ## the interaction does not significantly improve the fit, so we drop it from the model
```

##### Model B Coefficients (Log-odds)

```{r}
##summary of main effects
broom.mixed::tidy(haram.base, conf.int = TRUE, exponentiate = FALSE) %>% dplyr::select(-group) %>% filter(effect == "fixed") %>% mutate(p.value = round(p.value, 3)) %>% dplyr::select(-effect) %>% mutate_if(is.numeric, ~round(.x, digits = 3)) %>% kable()
```

##### Model B Coefficients (Odds Ratio)


```{r}

broom.mixed::tidy(haram.base, conf.int = TRUE, exponentiate = TRUE) %>% dplyr::select(-group) %>% filter(effect == "fixed") %>% mutate(p.value = round(p.value, 3)) %>% dplyr::select(-effect) %>% mutate_if(is.numeric, ~round(.x, digits = 3)) %>% kable()

```


#### Illegal

Model A: Answer ~ Task * Age + (1|subid)  
Model B: Answer ~ Task + Age + (1|subid)  

**Note** Model will not converge with item random effect. 

1.  Interaction term did not result in significant improvement to model fit ($\chi^{2}$(3) = 1.37, *p* = .71)
2.  No significant difference between moral and conventional ($\beta$ = 0.970, *t* = -0.123, *p* =.90, *CI* = (0.602, 1.565))
3.  Significant difference between moral and conventional-Iran ($\beta$ = 0.223, *t* = -5.658 *p* < .0005, *CI* = (0.132, 0.375))
4.  Significant difference moral and religious ($\beta$ = 2.171, *t* = 3.138, *p* = .002, *CI* = (1.338, 3.524))
5.  Significant effect of age ($\beta$ = 0.327, *t* = -4.483, *p* < .0005, *CI* = (0.200, 0.533))


##### Model A

```{r}
illegal <- glmer(answer ~ task*age.c + (1|subid),
                    data = subset(acceptability.ms, q_kind == 7),
                    family = 'binomial', 
                   control=glmerControl(optimizer="bobyqa",
                                             optCtrl=list(maxfun=2e4))) # converges

summary(illegal)
```

##### Model B

```{r}
## is the interaction between age and task significant?
illegal.base <- glmer(answer ~ task+age.c + (1|subid),
                    data = subset(acceptability.ms, q_kind == 7), 
                    family = 'binomial', 
                    control=glmerControl(optimizer="bobyqa",
                                             optCtrl=list(maxfun=2e4))) # converges
summary(illegal.base)
```

##### Model Comparison

```{r}
anova(illegal.base,illegal, test = 'lrt') ## the interaction does not significantly improve the fit, so we drop it from the model
```

##### Model B Coefficients (Log-odds)

```{r}

broom.mixed::tidy(illegal.base, conf.int = TRUE, exponentiate = FALSE) %>% dplyr::select(-group) %>% filter(effect == "fixed") %>% mutate(p.value = round(p.value, 3)) %>% dplyr::select(-effect) %>% mutate_if(is.numeric, ~round(.x, digits = 3)) %>% kable()
```

##### Model B Coefficients (Odds Ratio)

```{r}

broom.mixed::tidy(illegal.base, conf.int = TRUE, exponentiate = TRUE) %>% dplyr::select(-group) %>% filter(effect == "fixed") %>% mutate(p.value = round(p.value, 3)) %>% dplyr::select(-effect) %>% mutate_if(is.numeric, ~round(.x, digits = 3)) %>% kable()
```

#### Zesht

Model A: Answer ~ Task * Age + (1|subid)  
Model B: Answer ~ Task + Age + (1|subid)  

Note** Model will not converge with item random effect. 

1.  Interaction term did not result in significant improvement to model fit ($\chi^{2}$(3) = 1.3695, *p* = .7127)
2.  Significant difference between moral and conventional ($\beta$ = 0.154, *t* = -2.357, *p* =.018, *CI* = (0.032, 0.729))
3.  Significant difference between moral and conventional-Iran ($\beta$ = 0.058, *t* = -3.723, *p* < .0005, *CI* = (0.013, 0.259))
4.  Significant difference between moral and religious ($\beta$ = 0.054,*t* = -3.766,  *p* < .0005, *CI* = (0.012, 0.246))
5.  Significant effect of age ($\beta$ = 0.583, *t* = -2.261, *p* = .02, *CI* = (0.365, 0.931))


##### Model A
```{r}
zesht <- glmer(as.factor(answer) ~ task*age.c + (1|subid),
                    data = subset(tmp, q_kind == 8),
                    family = 'binomial', 
                   control=glmerControl(optimizer="bobyqa",
                                             optCtrl=list(maxfun=2e4))) # converges
summary(zesht)
```


##### Model B
```{r}
## is the interaction between age and task significant?
zesht.base <- glmer(as.factor(answer) ~ task+age.c + (1|subid),
                    data = subset(tmp, q_kind == 8), 
                    family = 'binomial', 
                    control=glmerControl(optimizer="bobyqa",
                                             optCtrl=list(maxfun=2e4))) # converges
summary(zesht.base)
```

##### Model Comparison
```{r}
anova(zesht.base,zesht, test = 'lrt') ## the interaction does not significantly improve the fit, so we drop it from the model
```

##### Model B Coefficients (Log-odds)

```{r}
##summary of main effects
broom.mixed::tidy(zesht.base, conf.int = TRUE, exponentiate = FALSE) %>% dplyr::select(-group) %>% filter(effect == "fixed") %>% mutate(p.value = round(p.value, 3)) %>% dplyr::select(-effect) %>% mutate_if(is.numeric, ~round(.x, digits = 3)) %>% kable()

```


##### Model B Coefficients (Odds Ratio)

```{r}
broom.mixed::tidy(zesht.base, conf.int = TRUE, exponentiate = TRUE) %>% dplyr::select(-group) %>% filter(effect == "fixed") %>% mutate(p.value = round(p.value, 3)) %>% dplyr::select(-effect) %>% mutate_if(is.numeric, ~round(.x, digits = 3)) %>% kable()

```
### Experiment 2 Permissibility Plot
```{r}

library(yarrr)
library(ggthemes)
library(viridis)

#global theme set
theme_set(theme_bw() + 
            theme(text = element_text(size=13),
                  axis.title=element_text(size=12),
                  strip.text = element_text(margin=margin(2,0,2,0)),
                  panel.grid = element_blank()))

my.cols <- c("#b499bb", "#a6d3d1", "#ffe498", "#83a4bb")

study_2_response_permissibility %>% 
  mutate(response = factor(response, 
                           levels = c("0", "1"), 
                           labels = c("No", "Yes"))) %>%
  mutate(transgression_type = factor(transgression_type,
                                     levels = c("moral", "conv", "conv.iran", "religious"),
                                     labels = c("Moral", "Conventional", "Conventional - Iran", "Religious"))) %>%
  mutate(q_kind_label = factor(q_kind_label, 
                               levels = c("Faraway country", 
                                          "Rule at school",
                                          "Everyone else", 
                                          "Foreigner",
                                          "Non-Muslim"),
                               labels = c("Would it be okay in \na faraway country?",
                                          "Would it be okay if \nthere was no \nrule against it?",
                                          "Would it be okay if \neveryone else \nwas doing it?",
                                          "Would it be okay if \na foreigner did it?",
                                          "Would it be okay if \na non-Muslim did it?"))) %>%
  dplyr::filter(response == "No" | response == "Yes") %>%
  ggplot(aes(x = response, (..count..) / sum(..count..), fill = transgression_type)) +
  geom_bar(position = position_dodge2(reverse = TRUE)) +
  facet_grid(~q_kind_label) +
  ylab("Proportion Response") +
  xlab("Response") +
  scale_y_continuous(breaks = pretty_breaks(n = 2)) + 
  coord_flip() +
  theme(axis.ticks.x = element_blank(), 
        legend.key.size = unit(.5, 'cm'), 
        legend.text = element_text(size = 10), 
        legend.title = element_text(size = 11), 
        legend.margin=margin(t = 0, unit='cm')) +
  scale_color_manual(values = my.cols) +
  scale_fill_manual(values = my.cols) +
  theme(text=element_text(family = "serif")) +
  theme(strip.text.x = element_text(size = 16),
        strip.text.y = element_text(size = 16, ),
        axis.text.x = element_text(angle = 0, size = 16, ),
        axis.text.y = element_text(size = 16),
        legend.text = element_text(size = 16),
        legend.title = element_text(size = 16),
        axis.title.x= element_text(vjust = -1, size=16),
        axis.title.y= element_text(vjust = 2.5, size=16),
        plot.margin=unit(c(6,6,6,6),"mm")) +
  guides(fill = guide_legend(title = "Transgression Type"))

study_2_permissibility_plot <- study_2_response_permissibility %>% 
  mutate(response = factor(response, 
                           levels = c("0", "1"), 
                           labels = c("No", "Yes"))) %>%
  mutate(transgression_type = factor(transgression_type,
                                     levels = c("moral", "conv", "conv.iran", "religious"),
                                     labels = c("Moral", "Conventional", "Conventional - Iran", "Religious"))) %>%
  mutate(q_kind_label = factor(q_kind_label, 
                               levels = c("Faraway country", 
                                          "Rule at school",
                                          "Everyone else", 
                                          "Foreigner",
                                          "Non-Muslim"),
                               labels = c("Would it be okay in \na faraway country?",
                                          "Would it be okay if \nthere was no \nrule against it?",
                                          "Would it be okay if \neveryone else \nwas doing it?",
                                          "Would it be okay if \na foreigner did it?",
                                          "Would it be okay if \na non-Muslim did it?"))) %>%
  dplyr::filter(response == "No" | response == "Yes") %>%
  ggplot(aes(x = response, (..count..) / sum(..count..), fill = transgression_type)) +
  geom_bar(position = position_dodge2(reverse = TRUE)) +
  facet_grid(~q_kind_label) +
  ylab("Proportion Response") +
  xlab("Response") +
  scale_y_continuous(breaks = pretty_breaks(n = 2)) + 
  coord_flip() +
  theme(axis.ticks.x = element_blank(), 
        legend.key.size = unit(.5, 'cm'), 
        legend.text = element_text(size = 10), 
        legend.title = element_text(size = 11), 
        legend.margin=margin(t = 0, unit='cm')) +
  scale_color_manual(values = my.cols) +
  scale_fill_manual(values = my.cols) +
  theme(text=element_text(family = "serif")) +
  theme(strip.text.x = element_text(size = 16),
        strip.text.y = element_text(size = 16, ),
        axis.text.x = element_text(angle = 0, size = 16, ),
        axis.text.y = element_text(size = 16),
        legend.text = element_text(size = 16),
        legend.title = element_text(size = 16),
        axis.title.x= element_text(vjust = -1, size=16),
        axis.title.y= element_text(vjust = 2.5, size=16),
        plot.margin=unit(c(6,6,6,6),"mm"),
        legend.position = "bottom") +
  guides(fill = guide_legend(title = "Transgression Type"))

study_2_permissibility_plot

```

```{r}


india_comprehension_data <- read_csv("india.csv") %>%
  filter(task == "practice") %>%
  dplyr::select(subid, task, item, answer) %>%
  mutate(answer = as.factor(answer)) %>%
  mutate(item = case_when(item == "bad" ~ "bad",
                          TRUE ~ "good")) %>%
  distinct(subid, task, item, answer)

india_comprehension_data %>% 
  group_by(item, answer) %>%
  dplyr::summarise(n = n())

india_comprehension_plot <- india_comprehension_data %>%
  ggplot(aes(x = answer)) +
  geom_bar() +
  facet_wrap(~item) +
  geom_text(stat = "count", aes(label = after_stat(count)), vjust = -0.5)

india_comprehension_plot

india_comprehension_data %>%
  filter(item == "good" & answer == "1") %>%
  dplyr::select(subid, task, item, answer)

```

